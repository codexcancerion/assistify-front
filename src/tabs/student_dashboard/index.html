<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400..800&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.tailwindcss.com"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400..800&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">

    <link href="../dist/output.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


</head>

<body class="bg-white-100 font-sans">

    <div class="flex h-screen">
        <!-- Sidebar ----------------------------------------------------------------------------------->

        <aside class="bg-[#f5f5f5] text-[#004a6d] w-64 p-6 h-screen flex flex-col fixed static">
            <!-- Logo -->
            <h1 class="text-5xl font-bold mb-6" style="font-family: 'Baloo 2', sans-serif;">
                <span style="color: #289DD2;">assist</span><span style="color: #e29830;">ify</span>
            </h1>

            <!-- Navigation -->
            <nav class="flex-grow flex flex-col justify-between">
                <ul>
                    <!-- Home -->
                    <li class="mb-4 flex items-center">
                        <svg class="h-6 w-6 text-[#289DD2] mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <a href="#home" class="hover:text-gray-600" title="Home">Home</a>
                    </li>

                    <!-- DTR -->
                    <li class="mb-4 flex items-center">
                        <svg class="h-6 w-6 text-[#289DD2] mr-2" width="24" height="24" viewBox="0 0 24 24"
                            stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z"></path>
                            <path d="M9 5H7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2V7a2 2 0 0 0 -2 -2h-2">
                            </path>
                            <rect x="9" y="3" width="6" height="4" rx="2"></rect>
                        </svg>
                        <a href="#dtr" class="hover:text-gray-600" title="Daily Time Record">DTR</a>
                    </li>

                    <!-- Tasks -->
                    <li class="mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <rect width="24" height="24" fill="none" />
                            <g fill="none" fill-rule="evenodd">
                                <path
                                    d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z" />
                                <path fill="#289DD2"
                                    d="M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm0 2h14v14H5zm11.95 4.795a1 1 0 1 0-1.414-1.414l-4.95 4.95l-2.121-2.121a1 1 0 0 0-1.415 1.414l2.758 2.758a1.1 1.1 0 0 0 1.556 0z" />
                            </g>
                        </svg>
                        <a href="#tasks" class="hover:text-gray-600" title="Tasks">Tasks</a>
                    </li>

                    <!-- Payroll -->
                    <li class="mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <rect width="24" height="24" fill="none" />
                            <g fill="none">
                                <path stroke="#289DD2" stroke-width="1.5"
                                    d="M4.318 20.536C5.636 22 7.758 22 12 22s6.364 0 7.682-1.465C21 19.072 21 16.714 21 12s0-7.071-1.318-8.536S16.242 2 12 2S5.636 2 4.318 3.464C3 4.93 3 7.286 3 12s0 7.071 1.318 8.535Z" />
                                <path stroke="#289DD2" stroke-width="1.5"
                                    d="M7 8c0-.465 0-.697.051-.888a1.5 1.5 0 0 1 1.06-1.06C8.304 6 8.536 6 9 6h6c.465 0 .697 0 .888.051a1.5 1.5 0 0 1 1.06 1.06C17 7.304 17 7.536 17 8s0 .697-.051.888a1.5 1.5 0 0 1-1.06 1.06C15.697 10 15.464 10 15 10H9c-.465 0-.697 0-.888-.051a1.5 1.5 0 0 1-1.06-1.06C7 8.696 7 8.464 7 8Z" />
                                <circle cx="8" cy="13" r="1" fill="#289DD2" />
                                <circle cx="8" cy="17" r="1" fill="#289DD2" />
                                <circle cx="12" cy="13" r="1" fill="#289DD2" />
                                <circle cx="12" cy="17" r="1" fill="#289DD2" />
                                <circle cx="16" cy="13" r="1" fill="#289DD2" />
                                <circle cx="16" cy="17" r="1" fill="#289DD2" />
                            </g>
                        </svg>
                        <a href="#payroll" class="hover:text-gray-600" title="Payroll">Payroll</a>
                    </li>
                </ul>

                <ul>
                    <!-- Profile -->
                    <li class="mb-4 flex items-center">
                        <div class="bg-gray-100 flex justify-left">
                            <ul class="mb-4 flex flex-col items-start">
                                <li class="mb-4 flex items-center relative">

                                    <button id="logout-btn"
                                        class="block px-4 py-2 w-full text-left text-gray-700 hover:bg-gray-100">Logout</button>
                                </li>
                            </ul>
                        </div>
                    </li>

                </ul>
            </nav>
        </aside>

        <!-- Main Section -->
        <div class="flex-1 p-6 ml-64" id="home">
            <!-- Welcome Section -->
            <div class="bg-[#289dd2] text-white rounded-lg p-10 mb-6">
                <div class="flex justify-between">
                    <div class="flex flex-col justify-center">
                        <h2 class="text-6xl font-bold" style="font-family: 'Baloo 2', sans-serif;">Welcome <span
                                id="student-name">Student</span>! ðŸ‘‹</h2>
                        <p class="text-xl mt-4" style="font-family: 'Baloo 2', sans-serif;">We're excited to have you
                            here. Let's make today a productive and successful one! ðŸŽ‰</p>
                    </div>
                    <div>
                        <div class="max-w-sm w-full bg-white shadow-lg rounded-lg overflow-hidden">
                            <div class="p-6 text-center">
                                <h2 id="name" class="text-2xl font-semibold text-gray-700"
                                    style="font-family: 'Baloo 2', sans-serif;"></h2>
                                <p id="department" class="text-sm text-gray-500"></p>
                            </div>
                            <div class="p-6 border-t">
                                <div class="flex items-center space-x-2 text-gray-600 mb-3">
                                    <i class="fas fa-envelope text-blue-500"></i>
                                    <span id="email" class="text-sm"></span>
                                </div>
                                <div class="flex items-center space-x-2 text-gray-600 mb-3">
                                    <i class="fas fa-id-card text-blue-500"></i>
                                    <span id="student_id" class="text-sm"></span>
                                </div>
                                <div class="flex items-center space-x-2 text-gray-600 mb-3">
                                    <i class="fas fa-user-tie text-blue-500"></i>
                                    <span id="supervisor_id" class="text-sm"></span>
                                </div>
                                <div class="flex items-center space-x-2 text-gray-600">
                                    <i class="fas fa-calendar-alt text-blue-500"></i>
                                    <span id="created_at" class="text-sm"></span>
                                </div>
                            </div>
                            <!-- Edit Button -->
                            <div class="p-6 border-t text-center">
                                <button id="edit-profile-btn"
                                    class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
                                    Edit Profile
                                </button>
                            </div>
                        </div>
                    </div>



                    <!-- Edit Profile Modal -->
                    <div id="edit-profile-modal"
                        class="fixed inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center hidden">
                        <div class="bg-white p-6 rounded-lg w-1/3 shadow-lg">
                            <h3 class="text-2xl text-[#004A6D] font-bold mb-4">Edit Profile</h3>

                            <!-- Edit Form -->
                            <form id="edit-profile-form">
                                <div class="mb-4">
                                    <label for="edit-name" class="block text-gray-700">Name</label>
                                    <input type="text" id="edit-name" name="name"
                                        class="w-full p-2 border border-gray-300 rounded-lg" />
                                </div>
                                <div class="mb-4">
                                    <label for="edit-email" class="block text-gray-700">Email</label>
                                    <input type="email" id="edit-email" name="email"
                                        class="w-full p-2 border border-gray-300 rounded-lg" />
                                </div>
                                <div class="mb-4">
                                    <label for="edit-department" class="block text-gray-700">Department</label>
                                    <input type="text" id="edit-department" name="department"
                                        class="w-full p-2 border border-gray-300 rounded-lg" />
                                </div>
                                <div class="mb-4">
                                    <label for="edit-supervisor" class="block text-gray-700">Supervisor</label>
                                    <input type="text" id="edit-supervisor" name="supervisor"
                                        class="w-full p-2 border border-gray-300 rounded-lg" />
                                </div>

                                <div class="flex justify-between">
                                    <button type="button" id="cancel-edit-btn"
                                        class="bg-gray-300 text-white py-2 px-4 rounded-lg hover:bg-gray-400">
                                        Cancel
                                    </button>
                                    <button type="submit" id="save-edit-btn"
                                        class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">
                                        Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>


                </div>
            </div>


            <!-- Daily Time Record Section -->
            <div class="bg-[#ededed] shadow rounded-lg p-10 mb-6" id="dtr">
                <h3 class="text-2xl text-[#004A6D] font-bold mb-4" style="font-family: 'Baloo 2', sans-serif;">Daily
                    Time Record</h3>
                <div class="grid grid-cols-2">

                    <div class="mt-5">
                        <p class="text-6xl text-[#004A6D] font-bold" style="font-family: 'Baloo 2', sans-serif;"
                            id="current-time">
                            <!-- The current time will be displayed here -->
                        </p>
                        <p class="pb-4">Current Time</p>
                        <button id="log-in-button"
                            class="bg-yellow-500 hover:bg-yellow-600 text-white text-5xl font-bold px-20 py-9 rounded-lg transition"
                            style="font-family: 'Baloo 2', sans-serif;">
                            Log In
                        </button>
                        <p id="logged-time" class="mt-4 text-lg text-[#004A6D]"
                            style="font-family: 'Montserrat', sans-serif;"></p>
                    </div>


                    <div class="grid gap-4 ">
                        <p class="font-bold text-[#004A6D]" style="font-family: 'Baloo 2', sans-serif;">Previous Logs
                        </p>
                        <ul id="time-logs-list">
                            <!-- Time logs will be injected here -->
                        </ul>
                        <button class="bg-[#289dd2] transition hover:bg-[#004A6D] p-3 text-white rounded-md">View
                            All</button>
                    </div>


                </div>
            </div>

            <!-- Tasks Section -->
            <div class="bg-[#ededed] shadow rounded-lg p-10 mb-6" id="tasks">
                <h3 class="text-2xl text-[#004A6D] font-bold mb-4" style="font-family: 'Baloo 2', sans-serif;">
                    Tasks
                </h3>
                <table class="w-full text-left border-spacing-4" id="taskTable">
                    <thead>
                        <tr class="text-[#004A6D]" style="font-family: 'Baloo 2', sans-serif;">
                            <th class="border-b-2 border-gray-300 pb-2 px-4">Description</th>
                            <th class="border-b-2 border-gray-300 pb-2 px-4">Deadline</th>
                            <th class="border-b-2 border-gray-300 pb-2 px-4">Priority</th>
                            <th class="border-b-2 border-gray-300 pb-2 px-4">Status</th>
                            <th class="border-b-2 border-gray-300 pb-2 px-4">Assigned To</th>
                            <th class="border-b-2 border-gray-300 pb-2 px-4"></th>
                        </tr>
                    </thead>
                    <tbody id="taskTableBody">
                        <!-- Dynamic content will be rendered here -->
                    </tbody>
                </table>


            </div>


            <!-- Payroll Calculator Section -->
            <div class="bg-[#ededed] shadow rounded-lg p-10 mb-10" id="payroll">
                <h3 class="text-2xl text-[#004A6D] font-bold mb-4" style="font-family: 'Baloo 2', sans-serif;">Payroll
                    Calculator</h3>
                <div class="px-10 flex justify-around">
                    <div>
                        <p id="totalHours" class="text-4xl text-center text-yellow-500 font-bold"
                            style="font-family: 'Baloo 2', sans-serif;">0 h.</p>
                        <p class="font-bold text-center text-[#004A6D]" style="font-family: 'Baloo 2', sans-serif;">
                            Total Hours Worked</p>
                    </div>
                    <div>
                        <p id="totalPayroll" class="text-4xl text-center text-yellow-500 font-bold"
                            style="font-family: 'Baloo 2', sans-serif;">â‚±0.00</p>
                        <p class="font-bold text-center text-[#004A6D]" style="font-family: 'Baloo 2', sans-serif;">
                            Total Accumulated Payroll</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {

            $('#logout-btn').on('click', function () {
                document.cookie = "student_id=" + "" + "; path=/; SameSite=Lax";

                window.location.reload()
            });

            // Function to get a cookie by name
            function getCookie(name) {
                let cookieArr = document.cookie.split(';');
                for (let i = 0; i < cookieArr.length; i++) {
                    let cookie = cookieArr[i].trim();
                    if (cookie.indexOf(name + '=') == 0) {
                        return cookie.substring(name.length + 1);
                    }
                }
                return null;
            }

            // Get the student's ID from the cookies
            var studentId = getCookie("student_id");
            let studentData;

            if (studentId) {
                // Make a GET request to retrieve the student's data using the ID
                $.ajax({
                    type: 'GET',
                    url: 'http://127.0.0.1:8000/api/students/' + studentId,
                    success: function (data) {
                        // Populate the student's data on the page
                        studentData = data;
                        $('#student-name').text(data.first_name);

                        // Populate the profile data using jQuery
                        $("#name").text(`${studentData.first_name} ${studentData.last_name}`);
                        $("#department").text(studentData.department);
                        $("#email").text(studentData.email);
                        $("#student_id").text(`Student ID: ${studentData.student_id}`);
                        $("#supervisor_id").text(`Supervisor ID: ${studentData.supervisor_id}`);
                        $("#created_at").text(`Created At: ${new Date(studentData.created_at).toLocaleString()}`);
                    },
                    error: function (xhr, status, error) {
                        console.error(xhr.responseText);
                        alert("Error loading student data.");
                    }
                });
            } else {
                alert("No student data found. Please log in again.");
                window.location.href = '/src/auth/wslogin/'; // Redirect to login page if no cookie is found
            }



            // Fetch time logs from the backend API
            fetch(`http://127.0.0.1:8000/api/time-logs?student_id=${studentId}`)
                .then(response => response.json())
                .then(timeLogs => {
                    // Render the time logs
                    const timeLogsList = document.getElementById('time-logs-list');
                    timeLogsList.innerHTML = ''; // Clear previous logs

                    // Limit to the first 5 logs
                    const limitedLogs = timeLogs.slice(0, 5);

                    limitedLogs.forEach(log => {
                        const { check_in, check_out, total_hours_worked } = log;

                        // Format check-in and check-out timestamps
                        const checkInDate = new Date(check_in).toLocaleDateString(); // Display only the date
                        const checkInTime = new Date(check_in).toLocaleTimeString(); // Display the time
                        let checkOutTime
                        check_out ? checkOutTime = new Date(check_out).toLocaleTimeString() : checkOutTime = null; // Display the time

                        // Create a list item to display the time log
                        const listItem = document.createElement('li');
                        listItem.classList.add('mb-2', 'p-2', 'border-b');
                        listItem.innerHTML = `
                            <strong>${checkInDate}</strong><br>
                            <span>${checkInTime} - ${checkOutTime || "Not logged out"}</span><br>
                            <span class="text-green-500">${checkOutTime ? total_hours_worked : "Ongoing"} hours worked</span>
                        `;
                        timeLogsList.appendChild(listItem);
                    });
                })
                .catch(error => console.error('Error fetching time logs:', error));






            // LOGIN LOGOUT FUNCTIONALITY
            function getCurrentTime() {
                const currentDate = new Date();
                let hours = currentDate.getHours();
                let minutes = currentDate.getMinutes();
                const ampm = hours >= 12 ? 'pm' : 'am';
                hours = hours % 12 || 12;
                minutes = minutes < 10 ? '0' + minutes : minutes;
                return `${hours}:${minutes} ${ampm}`;
            }

            // Set initial current time
            $('#current-time').text(getCurrentTime());

            // Update time every 10 seconds
            setInterval(() => {
                $('#current-time').text(getCurrentTime());
            }, 10000);

            // Fetch the time logs and determine the button state (Login / Logout)
            $.get(`http://127.0.0.1:8000/api/time-logs?student_id=${studentId}`, function (data) {
                if (data && data.length > 0) {
                    const firstLog = data[0];

                    if (firstLog.check_in && !firstLog.check_out) {
                        // If check_in exists but check_out is missing, show the logout option
                        $('#log-in-button').text('Log Out');
                        $('#log-in-button').removeClass('bg-yellow-500').addClass('bg-blue-500');
                        $('#logged-time').text(`You logged in at: ${firstLog.check_in}`);
                    } else if (firstLog.check_in && firstLog.check_out) {
                        // If both check_in and check_out exist, show the login option
                        $('#log-in-button').text('Log In');
                        $('#log-in-button').removeClass('bg-blue-500').addClass('bg-yellow-500');
                        $('#logged-time').text(`You logged out at: ${firstLog.check_out}`);
                    }
                } else {
                    // If no time log exists, assume the student hasn't logged in yet
                    $('#log-in-button').text('Log In');
                    $('#log-in-button').removeClass('bg-blue-500').addClass('bg-yellow-500');
                    $('#logged-time').text('You have not logged in yet.');
                }
            });

            // Handle Log In / Log Out button click
            $('#log-in-button').on('click', function () {
                const button = $('#log-in-button');
                const loggedTimeElement = $('#logged-time');

                if (button.text() === 'Log In') {
                    // Log in
                    $.post('http://127.0.0.1:8000/api/time-logs/login', { student_id: studentId }, function (response) {
                        if (response.time_log) {
                            loggedTimeElement.text(`You logged in at: ${response.time_log.check_in}`);
                            button.text('Log Out');
                            button.removeClass('bg-yellow-500').addClass('bg-blue-500');
                            window.location.reload()
                        }
                    });
                } else if (button.text() === 'Log Out') {
                    // Log out
                    $.post('http://127.0.0.1:8000/api/time-logs/logout', { student_id: studentId }, function (response) {
                        if (response.time_log) {
                            loggedTimeElement.text(`You logged out at: ${response.time_log.check_out}`);
                            button.text('Log In');
                            button.removeClass('bg-blue-500').addClass('bg-yellow-500');
                            window.location.reload()
                        }
                    });
                }
            });






            // TASKS FUNCTIONALITY
            // Function to fetch data from the API
            function fetchTasks() {
                $.ajax({
                    url: `http://127.0.0.1:8000/api/tasks?student_id=${studentId}`,  // Replace with your API endpoint
                    method: 'GET',  // Adjust the method based on your API (POST/GET)
                    success: function (data) {
                        renderTasks(data);  // Call the function to render tasks
                    },
                    error: function (error) {
                        console.error('Error fetching tasks:', error);
                    }
                });
            }
            // Function to render tasks in the table
            function renderTasks(tasks) {
                const $taskTableBody = $('#taskTableBody');
                $taskTableBody.empty();  // Clear any existing data

                tasks.forEach(task => {
                    const assignedTo = task.assigned_to.first_name + ' ' + task.assigned_to.last_name + ' (' + task.assigned_to.student_id + ')';
                    const priorityClass = task.priority === 'High' ? 'bg-red-400' : task.priority === 'Medium' ? 'bg-yellow-400' : 'bg-green-400';
                    const statusClass = task.status === 'Pending' ? 'bg-orange-400' : 'bg-green-400';

                    // Conditionally hide the "Mark Done" button if the status is "Completed"
                    const buttonHtml = task.status === 'Completed'
                        ? ''  // Empty string means no button
                        : `<button class="bg-blue-500 text-white px-4 py-1 rounded transition-colors duration-300 hover:bg-blue-600" style="font-family: 'Montserrat', sans-serif;" data-task-id="${task.id}">
                            Mark Done
                        </button>`;

                    // Create a new row
                    const row = `
                        <tr data-task-id="${task.id}">
                            <td class="py-2 px-4 rounded-lg" style="font-family: 'Montserrat', sans-serif;">
                                <div class="bg-white p-4 rounded-lg">${task.description}</div>
                            </td>
                            <td class="py-2 px-4 rounded-lg" style="font-family: 'Montserrat', sans-serif;">
                                <div class="bg-white p-4 rounded-lg">${task.deadline}</div>
                            </td>
                            <td class="${priorityClass} py-2 px-4 rounded-lg text-white" style="font-family: 'Montserrat', sans-serif;">
                                ${task.priority}
                            </td>
                            <td class="${statusClass} py-2 px-4 rounded-lg text-white" style="font-family: 'Montserrat', sans-serif;">
                                ${task.status}
                            </td>
                            <td class="bpy-2 px-4 rounded-lg" style="font-family: 'Montserrat', sans-serif;">
                                <div class="bg-white p-4 rounded-lg">${assignedTo}</div>
                            </td>
                            <td class="py-2 px-4">
                                ${buttonHtml}  <!-- Dynamically rendered button -->
                            </td>
                        </tr>
                    `;
                    // Append the row to the table body
                    $taskTableBody.append(row);
                });

                // Add event listeners for "Mark Done" buttons
                $('button').on('click', function () {
                    const taskId = $(this).data('task-id');  // Get the task ID from the button's data attribute
                    markTaskAsCompleted(taskId);
                });
            }

            // Function to mark the task as completed by calling the API
            function markTaskAsCompleted(taskId) {
                $.ajax({
                    url: `http://127.0.0.1:8000/api/tasks/${taskId}/complete`,  // API endpoint
                    method: 'PATCH',  // HTTP method
                    contentType: 'application/json',  // Set the content type to JSON
                    dataType: 'json',  // Expect JSON response
                    success: function (data) {
                        if (data.message === 'Task marked as completed') {
                            // Update the status of the task in the table
                            const taskRow = $(`[data-task-id="${taskId}"]`);
                            taskRow.find('td:nth-child(4)').text('Completed');  // Update the status cell
                            taskRow.find('button').remove();  // Remove the "Mark Done" button
                            taskRow.find('td:nth-child(4)').removeClass('bg-orange-400').addClass('bg-green-400');  // Update the status class
                            window.location.reload()
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error marking task as completed:', error);
                    }
                });
            }


            // Initial fetch of tasks when the page loads
            fetchTasks();



            // PAYROLL
            // Function to fetch time logs and calculate total hours worked and payroll
            function fetchAndCalculatePayroll() {
                $.ajax({
                    url: `http://127.0.0.1:8000/api/time-logs?student_id=${studentId}`,  // Your API endpoint
                    method: 'GET',
                    success: function (data) {
                        let totalHours = 0;
                        // Iterate over the time logs to sum up the total hours worked
                        data.forEach(log => {
                            totalHours += log.total_hours_worked; // Directly using the total_hours_worked from API
                        });

                        // Calculate payroll (50 PHP per hour)
                        const totalPayroll = totalHours * 50;

                        // Update the HTML with calculated values
                        $('#totalHours').text(`${totalHours} h.`);  // Display total hours worked
                        $('#totalPayroll').text(`â‚±${totalPayroll.toFixed(2)}`);  // Display the calculated payroll
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching time logs:', error);
                    }
                });
            }

            // Call the function to fetch and calculate on page load
            fetchAndCalculatePayroll();

        });






        // EDIT MODAL
        $(document).ready(function () {
            // Show the Edit Profile modal when the "Edit Profile" button is clicked
            $('#edit-profile-btn').click(function () {
                // Pre-fill the form with current profile data
                $('#edit-name').val($('#name').text());
                $('#edit-email').val($('#email').text());
                $('#edit-department').val($('#department').text());
                $('#edit-supervisor').val($('#supervisor_id').text());

                // Show the modal
                $('#edit-profile-modal').removeClass('hidden');
            });

            // Close the modal when the "Cancel" button is clicked
            $('#cancel-edit-btn').click(function () {
                $('#edit-profile-modal').addClass('hidden');
            });

            // Close the modal if clicked outside the modal area
            $(window).click(function (event) {
                if ($(event.target).is('#edit-profile-modal')) {
                    $('#edit-profile-modal').addClass('hidden');
                }
            });

            // Handle form submission to save changes
            $('#edit-profile-form').submit(function (event) {
                event.preventDefault();

                // Collect the data from the form
                const updatedProfile = {
                    name: $('#edit-name').val(),
                    email: $('#edit-email').val(),
                    department: $('#edit-department').val(),
                    supervisor: $('#edit-supervisor').val()
                };

                // You can send this data to your backend using an AJAX request (example below)
                $.ajax({
                    url: 'http://127.0.0.1:8000/api/students/update',  // Update with the appropriate API endpoint
                    type: 'PUT',
                    data: updatedProfile,
                    success: function (response) {
                        // Assuming the response contains the updated student data
                        // Update the profile card with the new information
                        $('#name').text(response.name);
                        $('#email').text(response.email);
                        $('#department').text(response.department);
                        $('#supervisor_id').text(response.supervisor);

                        // Close the modal
                        $('#edit-profile-modal').addClass('hidden');
                    },
                    error: function (xhr, status, error) {
                        console.error('Error saving profile:', error);
                    }
                });
            });
        });

    </script>


</body>

</html>